<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Changelog"><title>objc2::topics::changelog - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-492a78a4a87dcc01.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="objc2" data-themes="" data-resource-suffix="" data-rustdoc-version="1.82.0 (f6e511eec 2024-10-15)" data-channel="1.82.0" data-search-js="search-a99f1315e7cc5121.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-921df33f47b8780c.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-3b12f09e550e0385.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../objc2/index.html">objc2</a><span class="version">0.5.2</span></h2></div><h2 class="location"><a href="#">Module changelog</a></h2><div class="sidebar-elems"><h2><a href="../index.html">In objc2::<wbr>topics</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../index.html">objc2</a>::<wbr><a href="../index.html">topics</a>::<wbr><a class="mod" href="#">changelog</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../../src/objc2/topics/mod.rs.html#12">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="changelog"><a class="doc-anchor" href="#changelog">§</a>Changelog</h2>
<p>Notable changes to this crate will be documented in this file.</p>
<p>The format is based on <a href="https://keepachangelog.com/en/1.0.0/">Keep a Changelog</a>.</p>
<h3 id="unreleased---yyyy-mm-dd"><a class="doc-anchor" href="#unreleased---yyyy-mm-dd">§</a>Unreleased - YYYY-MM-DD</h3><h3 id="052---2024-05-21"><a class="doc-anchor" href="#052---2024-05-21">§</a>0.5.2 - 2024-05-21</h3><h4 id="added"><a class="doc-anchor" href="#added">§</a>Added</h4>
<ul>
<li>Added <code>Retained::autorelease_ptr</code>.</li>
<li>Added the feature flag <code>"relax-sign-encoding"</code>, which when enabled, allows
using e.g. <code>NSInteger</code> in places where you would otherwise have to use
<code>NSUInteger</code>.</li>
</ul>
<h4 id="changed"><a class="doc-anchor" href="#changed">§</a>Changed</h4>
<ul>
<li>
<p>Renamed <code>Id</code> to <code>Retained</code>, to better reflect what it represents.</p>
<p>The old name is kept as a soft-deprecated type-alias (will be fully
deprecated in <code>v0.6.0</code>).</p>
<p>The same is done for:</p>
<ul>
<li><code>rc::WeakId</code> to <code>rc::Weak</code>.</li>
<li><code>rc::DefaultId</code> to <code>rc::DefaultRetained</code>.</li>
<li><code>rc::IdFromIterator</code> to <code>rc::RetainedFromIterator</code>.</li>
<li><code>rc::IdIntoIterator</code> to <code>rc::RetainedIntoIterator</code>.</li>
</ul>
</li>
</ul>
<h4 id="deprecated"><a class="doc-anchor" href="#deprecated">§</a>Deprecated</h4>
<ul>
<li>Deprecated the <code>apple</code> Cargo feature flag, it is assumed by default on Apple
platforms.</li>
</ul>
<h3 id="051---2024-04-17"><a class="doc-anchor" href="#051---2024-04-17">§</a>0.5.1 - 2024-04-17</h3><h4 id="added-1"><a class="doc-anchor" href="#added-1">§</a>Added</h4>
<ul>
<li>Made the following runtime methods available without the <code>"malloc"</code> feature
flag:
<ul>
<li><code>Method::return_type</code>.</li>
<li><code>Method::argument_type</code>.</li>
<li><code>AnyClass::classes</code>.</li>
<li><code>AnyClass::instance_methods</code>.</li>
<li><code>AnyClass::adopted_protocols</code>.</li>
<li><code>AnyClass::instance_variables</code>.</li>
<li><code>AnyProtocol::protocols</code>.</li>
<li><code>AnyProtocol::adopted_protocols</code>.</li>
</ul>
</li>
<li>Added <code>Id::into_raw</code> as the oppositve of <code>Id::from_raw</code>.</li>
<li>Added the following missing methods on <code>NSObjectProtocol</code>:
<ul>
<li><code>isEqual</code>.</li>
<li><code>hash</code>.</li>
<li><code>isKindOfClass</code>.</li>
<li><code>isMemberOfClass</code>.</li>
<li><code>respondsToSelector</code>.</li>
<li><code>conformsToProtocol</code>.</li>
<li><code>description</code>.</li>
<li><code>debugDescription</code>.</li>
<li><code>isProxy</code>.</li>
<li><code>retainCount</code>.</li>
</ul>
</li>
<li>Added <code>NSObject::init</code>.</li>
<li>Added <code>NSObject::doesNotRecognizeSelector</code>.</li>
</ul>
<h4 id="changed-1"><a class="doc-anchor" href="#changed-1">§</a>Changed</h4>
<ul>
<li>Moved <code>ClassBuilder</code> and <code>ProtocolBuilder</code> from the <code>declare</code> module to the
<code>runtime</code> module. The old locations are deprecated.</li>
<li>Enabled the <code>"verify"</code> feature flag’s functionality when debug assertions are
enabled.</li>
<li>Renamed <code>Id::new</code> to <code>Id::from_raw</code>. The previous name is kept as a
deprecated alias.</li>
</ul>
<h3 id="050---2023-12-03"><a class="doc-anchor" href="#050---2023-12-03">§</a>0.5.0 - 2023-12-03</h3><h4 id="added-2"><a class="doc-anchor" href="#added-2">§</a>Added</h4>
<ul>
<li>Added the following traits to the <code>mutability</code> module (see the documentation
for motivation and usage info):
<ul>
<li><code>HasStableHash</code>.</li>
<li><code>IsAllowedMutable</code>.</li>
<li><code>IsMainThreadOnly</code>.</li>
<li><code>CounterpartOrSelf</code>.</li>
</ul>
</li>
<li>Added new <code>encode</code> traits <code>EncodeReturn</code>, <code>EncodeArgument</code> and
<code>EncodeArguments</code>.</li>
<li>Added methods <code>as_ptr</code> and <code>as_mut_ptr</code> to <code>Allocated</code>.</li>
<li>Added optimization for converting <code>msg_send_id![cls, alloc]</code> to a call to
the faster runtime function <code>objc_alloc</code>.</li>
<li>Added <code>DeclaredClass</code>, which represents classes that are declared in Rust.</li>
<li>Added <code>Allocated::set_ivars</code>, which sets the instance variables of an
object, and returns the new <code>rc::PartialInit</code>.</li>
<li>Added the ability for <code>msg_send_id!</code> to call <code>super</code> methods.</li>
<li>Implement <code>Send</code> and <code>Sync</code> for <code>ProtocolObject</code> if the underlying protocol
implements it.</li>
<li>Added ability to create <code>Send</code> and <code>Sync</code> versions of
<code>ProtocolObject&lt;dyn NSObjectProtocol&gt;</code>.</li>
</ul>
<h4 id="changed-2"><a class="doc-anchor" href="#changed-2">§</a>Changed</h4>
<ul>
<li>
<p><strong>BREAKING</strong>: Changed how instance variables work in <code>declare_class!</code>.</p>
<p>Previously, instance variables had to implement <code>Encode</code>, and you had to
initialize them properly, which was difficult to ensure.</p>
<p>Now, you implement the new <code>DeclaredClass</code> trait instead, which helps to
ensure all of this for you.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// Before
</span><span class="macro">declare_class!</span>(
    <span class="kw">struct </span>MyObject {
        object: IvarDrop&lt;Id&lt;NSObject&gt;, <span class="string">"_object"</span>&gt;,
        data: IvarDrop&lt;<span class="prelude-ty">Option</span>&lt;Box&lt;MyData&gt;&gt;, <span class="string">"_data"</span>&gt;,
    }

    <span class="kw">mod </span>ivars;

    <span class="kw">unsafe impl </span>ClassType <span class="kw">for </span>MyObject {
        <span class="kw">type </span>Super = NSObject;
        <span class="kw">type </span>Mutability = InteriorMutable;
        <span class="kw">const </span>NAME: <span class="kw-2">&amp;</span><span class="lifetime">'static </span>str = <span class="string">"MyObject"</span>;
    }

    <span class="kw">unsafe impl </span>MyObject {
        <span class="attr">#[method(init)]
        </span><span class="kw">unsafe fn </span>init(this: <span class="kw-2">*mut </span><span class="self">Self</span>) -&gt; <span class="prelude-ty">Option</span>&lt;NonNull&lt;<span class="self">Self</span>&gt;&gt; {
            <span class="kw">let </span>this: <span class="prelude-ty">Option</span>&lt;<span class="kw-2">&amp;mut </span><span class="self">Self</span>&gt; = <span class="macro">msg_send!</span>[<span class="kw">super</span>(this), init];
            this.map(|this| {
                Ivar::write(<span class="kw-2">&amp;mut </span>this.object, NSObject::new());
                Ivar::write(<span class="kw-2">&amp;mut </span>this.data, Box::new(MyData::new()));
                NonNull::from(this)
            })
        }
    }
);

<span class="macro">extern_methods!</span>(
    <span class="kw">unsafe impl </span>MyObject {
        <span class="attr">#[method_id(new)]
        </span><span class="kw">pub fn </span>new() -&gt; Id&lt;<span class="self">Self</span>&gt;;
    }
);

<span class="kw">fn </span>main() {
    <span class="kw">let </span>obj = MyObject::new();
    <span class="macro">println!</span>(<span class="string">"{:?}"</span>, obj.object);
}

<span class="comment">// After
</span><span class="kw">struct </span>MyIvars {
    object: Id&lt;NSObject&gt;,
    data: <span class="prelude-ty">Option</span>&lt;Box&lt;MyData&gt;&gt;,
}

<span class="macro">declare_class!</span>(
    <span class="kw">struct </span>MyObject;

    <span class="kw">unsafe impl </span>ClassType <span class="kw">for </span>MyObject {
        <span class="kw">type </span>Super = NSObject;
        <span class="kw">type </span>Mutability = InteriorMutable;
        <span class="kw">const </span>NAME: <span class="kw-2">&amp;</span><span class="lifetime">'static </span>str = <span class="string">"MyObject"</span>;
    }

    <span class="kw">impl </span>DeclaredClass <span class="kw">for </span>MyObject {
        <span class="kw">type </span>Ivars = MyIvars;
    }

    <span class="kw">unsafe impl </span>MyObject {
        <span class="attr">#[method_id(init)]
        </span><span class="kw">pub fn </span>init(this: Allocated&lt;<span class="self">Self</span>&gt;) -&gt; <span class="prelude-ty">Option</span>&lt;Id&lt;<span class="self">Self</span>&gt;&gt; {
            <span class="kw">let </span>this = this.set_ivars(MyIvars {
                object: NSObject::new(),
                data: MyData::new(),
            });
            <span class="kw">unsafe </span>{ <span class="macro">msg_send_id!</span>[<span class="kw">super</span>(this), init] }
        }
    }
);

<span class="macro">extern_methods!</span>(
    <span class="kw">unsafe impl </span>MyObject {
        <span class="attr">#[method_id(new)]
        </span><span class="kw">pub fn </span>new() -&gt; Id&lt;<span class="self">Self</span>&gt;;
    }
);

<span class="kw">fn </span>main() {
    <span class="kw">let </span>obj = MyObject::new();
    <span class="macro">println!</span>(<span class="string">"{:?}"</span>, obj.ivars().object);
}</code></pre></div>
</li>
<li>
<p><strong>BREAKING</strong>: <code>AnyClass::verify_sel</code> now take more well-defined types
<code>EncodeArguments</code> and  <code>EncodeReturn</code>.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Changed how the <code>mutability</code> traits work; these no longer have
<code>ClassType</code> as a super trait, allowing them to work for <code>ProtocolObject</code> as
well.</p>
<p>This effectively means you can now <code>copy</code> a <code>ProtocolObject&lt;dyn NSCopying&gt;</code>.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Allow implementing <code>DefaultId</code> for any type, not just those
who are <code>IsAllocableAnyThread</code>.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Moved the <code>MethodImplementation</code> trait from the <code>declare</code>
module to the <code>runtime</code> module.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Moved the <code>MessageReceiver</code> trait to the <code>runtime</code> module.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Make the <code>MessageReceiver</code> trait no longer implemented for
references to <code>Id</code>. Dereference the <code>Id</code> yourself.</p>
<p>Note: Passing <code>&amp;Id</code> in <code>msg_send!</code> is still supported.</p>
</li>
<li>
<p><strong>BREAKING</strong>: <code>MessageReceiver::send_message</code> and
<code>MessageReceiver::send_super_message</code> now take <code>EncodeArguments</code> and return
<code>EncodeReturn</code>, instead of internal traits.</p>
<p>This is done to make <code>MessageReceiver</code> more straightforward to understand,
although it now also has slightly less functionality than <code>msg_send!</code>.</p>
<p>In particular automatic conversion of <code>bool</code> is not supported in
<code>MessageReceiver</code>.</p>
</li>
<li>
<p>Relaxed the requirements for receivers in <code>MethodImplementation</code>; now,
anything that implements <code>MessageReceiver</code> can be used as the receiver of
a method.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Renamed the associated types <code>Ret</code> and <code>Args</code> on
<code>MethodImplementation</code> to <code>Return</code> and <code>Arguments</code>.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Make <code>rc::Allocated</code> allowed to be <code>NULL</code> internally, such
that uses of <code>Option&lt;Allocated&lt;T&gt;&gt;</code> is now simply <code>Allocated&lt;T&gt;</code>.</p>
</li>
<li>
<p><code>AnyObject::class</code> now returns a <code>'static</code> reference to the class.</p>
</li>
<li>
<p>Relaxed <code>ProtocolType</code> requirement on <code>ProtocolObject</code>.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Updated <code>encode</code> types to those from <code>objc2-encode v4.0.0</code>.</p>
</li>
</ul>
<h4 id="deprecated-1"><a class="doc-anchor" href="#deprecated-1">§</a>Deprecated</h4>
<ul>
<li>
<p>Soft deprecated using <code>msg_send!</code> without a comma between arguments (i.e.
deprecated when the <code>"unstable-msg-send-always-comma"</code> feature is enabled).</p>
<p>See the following for an example of how to upgrade:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// Before
</span><span class="kw">let _</span>: NSInteger = <span class="macro">msg_send!</span>[
    obj,
    addTrackingRect:rect
    owner:obj
    userData:ptr::null_mut::&lt;c_void&gt;()
    assumeInside:Bool::NO
];
<span class="comment">// After
</span><span class="kw">let _</span>: NSInteger = <span class="macro">msg_send!</span>[
    obj,
    addTrackingRect: rect,
    owner: obj,
    userData: ptr::null_mut::&lt;c_void&gt;(),
    assumeInside: <span class="bool-val">false</span>,
];</code></pre></div>
</li>
</ul>
<h4 id="fixed"><a class="doc-anchor" href="#fixed">§</a>Fixed</h4>
<ul>
<li>
<p>Fixed the name of the protocol that <code>NSObjectProtocol</code> references.</p>
</li>
<li>
<p>Allow cloning <code>Id&lt;AnyObject&gt;</code>.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Restrict message sending to <code>&amp;mut</code> references to things that
implement <code>IsAllowedMutable</code>.</p>
</li>
<li>
<p>Disallow the ability to use non-<code>Self</code>-like types as the receiver in
<code>declare_class!</code>.</p>
</li>
<li>
<p>Allow adding instance variables with the same name on Apple platforms.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Make loading instance variables robust and sound in the face
of instance variables with the same name.</p>
<p>To read or write the instance variable for an object, you should now use the
<code>load</code>, <code>load_ptr</code> and <code>load_mut</code> methods on <code>Ivar</code>, instead of the <code>ivar</code>,
<code>ivar_ptr</code> and <code>ivar_mut</code> methods on <code>AnyObject</code>.</p>
<p>This <em>is</em> more verbose, but it also ensures that the class for the instance
variable you’re loading is the same as the one the instance variable you
want to access is defined on.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// Before
</span><span class="kw">let </span>number = <span class="kw">unsafe </span>{ <span class="kw-2">*</span>obj.ivar::&lt;u32&gt;(<span class="string">"number"</span>) };

<span class="comment">// After
</span><span class="kw">let </span>ivar = cls.instance_variable(<span class="string">"number"</span>).unwrap();
<span class="kw">let </span>number = <span class="kw">unsafe </span>{ <span class="kw-2">*</span>ivar.load::&lt;u32&gt;(<span class="kw-2">&amp;</span>obj) };</code></pre></div>
</li>
<li>
<p>Implement <code>RefEncode</code> normally for <code>c_void</code>. This makes <code>AtomicPtr&lt;c_void&gt;</code>
implement <code>Encode</code>.</p>
</li>
</ul>
<h4 id="removed"><a class="doc-anchor" href="#removed">§</a>Removed</h4>
<ul>
<li>
<p><strong>BREAKING</strong>: Removed <code>ProtocolType</code> implementation for <code>NSObject</code>.
Use the more precise <code>NSObjectProtocol</code> trait instead!</p>
</li>
<li>
<p><strong>BREAKING</strong>: Removed the <code>MessageArguments</code> trait.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Removed the following items from the <code>declare</code> module: <code>Ivar</code>,
<code>IvarEncode</code>, <code>IvarBool</code>, <code>IvarDrop</code>, <code>IvarType</code> and <code>InnerIvarType</code>.</p>
<p>Ivar functionality is available in a different form now, see above under
“Changed”.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Removed <code>ClassBuilder::add_static_ivar</code>.</p>
</li>
</ul>
<h3 id="041---2023-07-31"><a class="doc-anchor" href="#041---2023-07-31">§</a>0.4.1 - 2023-07-31</h3><h4 id="added-3"><a class="doc-anchor" href="#added-3">§</a>Added</h4>
<ul>
<li>Allow using <code>MainThreadMarker</code> in <code>extern_methods!</code>.</li>
<li>Added the feature flag <code>"relax-void-encoding"</code>, which when enabled, allows
using <code>*mut c_void</code> in a few places where you would otherwise have to
specify the encoding precisely.</li>
</ul>
<h4 id="changed-3"><a class="doc-anchor" href="#changed-3">§</a>Changed</h4>
<ul>
<li>
<p>Renamed <code>runtime</code> types:</p>
<ul>
<li><code>Object</code> to <code>AnyObject</code>.</li>
<li><code>Class</code> to <code>AnyClass</code>.</li>
<li><code>Protocol</code> to <code>AnyProtocol</code>.</li>
</ul>
<p>To better fit with Swift’s naming scheme. The types are still available
under the old names as deprecated aliases.</p>
</li>
</ul>
<h4 id="fixed-1"><a class="doc-anchor" href="#fixed-1">§</a>Fixed</h4>
<ul>
<li>
<p><strong>BREAKING</strong>: Updated <code>encode</code> types to those from <code>objc2-encode v3.0.0</code>.</p>
<p>This is technically a breaking change, but it should allow this crate to be
compiled together with pre-release versions of it, meaning that in practice
strictly more code out there will compile because of this. Hence it was
deemed the better trade-off.</p>
</li>
</ul>
<h3 id="040---2023-06-20"><a class="doc-anchor" href="#040---2023-06-20">§</a>0.4.0 - 2023-06-20</h3><h4 id="added-4"><a class="doc-anchor" href="#added-4">§</a>Added</h4>
<ul>
<li>
<p>Added <code>objc2::rc::autoreleasepool_leaking</code>, and improve performance of
objects <code>Debug</code> impls.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Added associated type <code>ClassType::Mutability</code>, which replaces
the ownership type on <code>Id</code>, and must be specified for all class types.</p>
<p>An example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// Before
</span><span class="kw">use </span>objc2::runtime::NSObject;
<span class="kw">use </span>objc2::{declare_class, ClassType};

<span class="macro">declare_class!</span>(
    <span class="kw">struct </span>MyDelegate;

    <span class="kw">unsafe impl </span>ClassType <span class="kw">for </span>MyDelegate {
        <span class="kw">type </span>Super = NSObject;
    }

    <span class="comment">// ... methods
</span>);

<span class="comment">// After
</span><span class="kw">use </span>objc2::runtime::NSObject;
<span class="kw">use </span>objc2::mutability::InteriorMutable;
<span class="kw">use </span>objc2::{declare_class, ClassType};

<span class="macro">declare_class!</span>(
    <span class="kw">struct </span>MyDelegate;

    <span class="kw">unsafe impl </span>ClassType <span class="kw">for </span>MyDelegate {
        <span class="kw">type </span>Super = NSObject;
        <span class="kw">type </span>Mutability = InteriorMutable; <span class="comment">// Added
    </span>}

    <span class="comment">// ... methods
</span>);</code></pre></div>
</li>
<li>
<p>Added <code>ClassType::retain</code>, which is a safe way to go from a reference <code>&amp;T</code>
to an <code>Id&lt;T&gt;</code>.</p>
</li>
<li>
<p>Added <code>mutability</code> module, containing various types that can be specified
for the above.</p>
</li>
<li>
<p>Preliminary support for specifying <code>where</code> bounds on methods inside
<code>extern_protocol!</code> and <code>extern_methods!</code>.</p>
</li>
<li>
<p>Allow arbitary expressions in <code>const NAME</code> in <code>extern_class!</code>,
<code>extern_protocol!</code> and <code>declare_class!</code>.</p>
</li>
<li>
<p>Added <code>rc::IdIntoIterator</code> helper trait and forwarding <code>IntoIterator</code>
implementations for <code>rc::Id</code>.</p>
</li>
<li>
<p>Added <code>rc::IdFromIterator</code> helper trait for implementing <code>IntoIterator</code>
for <code>rc::Id</code>.</p>
</li>
<li>
<p>Added <code>Display</code> impl for <code>runtime::Class</code>, <code>runtime::Sel</code> and
<code>runtime::Protocol</code>.</p>
</li>
<li>
<p>Added <code>Debug</code> impl for <code>runtime::Method</code> and <code>runtime::Ivar</code>.</p>
</li>
<li>
<p>Added <code>Method::set_implementation</code>.</p>
</li>
<li>
<p>Added <code>Method::exchange_implementation</code>.</p>
</li>
<li>
<p>Added <code>Object::set_class</code>.</p>
</li>
</ul>
<h4 id="changed-4"><a class="doc-anchor" href="#changed-4">§</a>Changed</h4>
<ul>
<li>
<p><strong>BREAKING</strong>: <code>objc2::rc::AutoreleasePool</code> is now a zero-sized <code>Copy</code> type
with a lifetime parameter, instead of the lifetime parameter being the
reference it was behind.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Made <code>Id::autorelease</code> and <code>Id::autorelease_return</code> be
associated functions instead of methods. This means they now have to be
called as <code>Id::autorelease(obj, pool)</code> instead of <code>obj.autorelease(pool)</code>.</p>
<p>Additionally, rename the mutable version to <code>Id::autorelease_mut</code>.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Moved <code>VerificationError</code>, <code>ProtocolObject</code> and
<code>ImplementedBy</code> into the <code>runtime</code> module.</p>
</li>
<li>
<p>Relaxed a <code>fmt::Debug</code> bound on <code>WeakId</code>’s own <code>fmt::Debug</code> impl.</p>
</li>
<li>
<p>Changed <code>Debug</code> impl for <code>runtime::Class</code>, <code>runtime::Sel</code> and
<code>runtime::Protocol</code> to give more information.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Updated <code>encode</code> module to <code>objc2-encode v2.0.0</code>.</p>
</li>
</ul>
<h4 id="fixed-2"><a class="doc-anchor" href="#fixed-2">§</a>Fixed</h4>
<ul>
<li>Fixed using autorelease pools on 32bit macOS and older macOS versions.</li>
<li>Fixed memory leaks in and improved performance of <code>exception::catch</code>.</li>
</ul>
<h4 id="removed-1"><a class="doc-anchor" href="#removed-1">§</a>Removed</h4>
<ul>
<li>
<p><strong>BREAKING</strong>: Removed <code>rc::SliceId</code>, since it is implementable outside
<code>objc2</code> from the layout guarantees of <code>rc::Id</code>.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Removed <code>Ownership</code> type parameter from <code>Id</code>, as well as
<code>rc::Ownership</code>, <code>rc::Owned</code>, <code>rc::Shared</code>, <code>Id::from_shared</code> and
<code>Id::into_shared</code>. This functionality has been moved from being at the
“usage-level”, to being moved to the “type-level” in the associated type
<code>ClassType::Mutability</code>.</p>
<p>While being slightly more restrictive, it should vastly help you avoid
making mistakes around mutability (e.g. it is usually a mistake to make a
mutable reference <code>&amp;mut</code> to an Objective-C object).</p>
<p>An example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// Before
</span><span class="kw">use </span>objc2::rc::{Id, Shared};
<span class="kw">use </span>objc2::runtime::NSObject;
<span class="kw">use </span>objc2::msg_send_id;

<span class="kw">let </span>obj: Id&lt;NSObject, Shared&gt; = <span class="kw">unsafe </span>{ <span class="macro">msg_send_id!</span>[NSObject::class(), new] };

<span class="comment">// After
</span><span class="kw">use </span>objc2::rc::Id;
<span class="kw">use </span>objc2::runtime::NSObject;
<span class="kw">use </span>objc2::msg_send_id;

<span class="kw">let </span>obj: Id&lt;NSObject&gt; = <span class="kw">unsafe </span>{ <span class="macro">msg_send_id!</span>[NSObject::class(), new] };</code></pre></div>
</li>
<li>
<p><strong>BREAKING</strong>: Removed <code>impl&lt;T&gt; TryFrom&lt;WeakId&lt;T&gt;&gt; for Id&lt;T&gt;</code> impl since it
did not have a proper error type, making it less useful than <code>WeakId::load</code>.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Removed forwarding <code>Iterator</code> implementation for <code>Id</code>, since
it conflicts with the <code>IntoIterator</code> implementation that it now has instead.</p>
</li>
</ul>
<h3 id="030-beta5---2023-02-07"><a class="doc-anchor" href="#030-beta5---2023-02-07">§</a>0.3.0-beta.5 - 2023-02-07</h3><h4 id="added-5"><a class="doc-anchor" href="#added-5">§</a>Added</h4>
<ul>
<li>
<p>Support <code>#[cfg(...)]</code> attributes in <code>extern_class!</code> macro.</p>
</li>
<li>
<p>Added support for selectors with multiple colons like <code>abc::</code> in the <code>sel!</code>,
<code>extern_class!</code>, <code>extern_protocol!</code> and <code>declare_class!</code> macros.</p>
</li>
<li>
<p>Added ability to use <code>#[method_id(mySelector:)]</code> inside <code>declare_class!</code>,
like you would do in <code>extern_methods!</code>.</p>
</li>
<li>
<p>Added 16-fold impls for <code>EncodeArguments</code>, <code>MessageArguments</code>, and <code>MethodImplementation</code>.</p>
</li>
<li>
<p>Added <code>NSObjectProtocol</code> trait for allowing <code>ProtocolObject</code> to implement
<code>Debug</code>, <code>Hash</code>, <code>PartialEq</code> and <code>Eq</code>.</p>
</li>
<li>
<p>Support running <code>Drop</code> impls on <code>dealloc</code> in <code>declare_class!</code>.</p>
</li>
<li>
<p>Added <code>declare::IvarEncode</code> and <code>declare::IvarBool</code> types.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Moved the <code>objc2_encode</code> traits to <code>objc2::encode</code>.</p>
<p>This includes removing the <code>EncodeConvert</code> and <code>EncodeArguments</code> traits.</p>
</li>
<li>
<p>Added support for out-parameters like <code>&amp;mut Id&lt;_, _&gt;</code> in <code>msg_send!</code>,
<code>msg_send_id!</code> and <code>extern_methods!</code>.</p>
</li>
</ul>
<h4 id="changed-5"><a class="doc-anchor" href="#changed-5">§</a>Changed</h4>
<ul>
<li>
<p><strong>BREAKING</strong>: Using the automatic <code>NSError**</code>-to-<code>Result</code> functionality in
<code>extern_methods!</code> now requires a trailing underscore (so now it’s
<code>#[method(myMethod:error:_)]</code> instead of <code>#[method(myMethod:error:)]</code>).</p>
</li>
<li>
<p><strong>BREAKING</strong>: Fundamentally changed how protocols work. Instead of being
structs with inherent methods, they’re now traits. This means that you can
use their methods more naturally from your Objective-C objects.</p>
<p>An example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// Before
</span><span class="macro">extern_protocol!</span>(
    <span class="kw">struct </span>MyProtocol;

    <span class="kw">unsafe impl </span>ProtocolType <span class="kw">for </span>MyProtocol {
        <span class="attr">#[method(myMethod)]
        </span><span class="kw">fn </span>myMethod(<span class="kw-2">&amp;</span><span class="self">self</span>);
    }
);

<span class="kw">let </span>obj: <span class="kw-2">&amp;</span>SomeObjectThatImplementsTheProtocol = ...;
<span class="kw">let </span>proto: <span class="kw-2">&amp;</span>MyProtocol = obj.as_protocol();
proto.myMethod();

<span class="comment">// After
</span><span class="macro">extern_protocol!</span>(
    <span class="kw">unsafe trait </span>MyProtocol {
        <span class="attr">#[method(myMethod)]
        </span><span class="kw">fn </span>myMethod(<span class="kw-2">&amp;</span><span class="self">self</span>);
    }

    <span class="kw">unsafe impl </span>ProtocolType <span class="kw">for dyn </span>MyProtocol {}
);

<span class="kw">let </span>obj: <span class="kw-2">&amp;</span>SomeObjectThatImplementsTheProtocol = ...;
obj.myMethod();
<span class="comment">// Or
</span><span class="kw">let </span>proto: <span class="kw-2">&amp;</span>ProtocolObject&lt;<span class="kw">dyn </span>MyProtocol&gt; = ProtocolObject::from_ref(obj);
proto.myMethod();</code></pre></div>
<p>The <code>ConformsTo</code> trait has similarly been removed, and the <code>ImplementedBy</code>
trait and <code>ProtocolObject</code> struct has been introduced instead.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Moved <code>NSObject::is_kind_of</code> to the new <code>NSObjectProtocol</code>.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Removed support for custom <code>dealloc</code> impls in
<code>declare_class!</code>. Implement <code>Drop</code> for the type instead.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Changed how the <code>declare_class!</code> macro works.</p>
<p>Now, you must explicitly specify the “kind” of ivar you want, as well as the
ivar name. Additionally, the class name must be explicitly specified.</p>
<p>This change is done to make it easier to see what’s going on beneath the
hood (the name will be available in the final binary, which is important to
be aware of)!</p>
<p>An example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// Before
</span><span class="macro">declare_class!</span>(
    <span class="kw">struct </span>MyClass {
        <span class="kw">pub </span>ivar: u8,
        another_ivar: bool,
        box_ivar: IvarDrop&lt;Box&lt;i32&gt;&gt;,
    }

    <span class="kw">unsafe impl </span>ClassType <span class="kw">for </span>MyClass {
        <span class="kw">type </span>Super = NSObject;
    }
);

<span class="comment">// After
</span><span class="macro">declare_class!</span>(
    <span class="kw">struct </span>MyClass {
        <span class="kw">pub </span>ivar: IvarEncode&lt;u8, <span class="string">"_ivar"</span>&gt;,
        another_ivar: IvarBool&lt;<span class="string">"_another_ivar"</span>&gt;,
        box_ivar: IvarDrop&lt;Box&lt;i32&gt;, <span class="string">"_box_ivar"</span>&gt;,
    }

    <span class="comment">// Helper types for ivars will be put in here
    </span><span class="kw">mod </span>ivars;

    <span class="kw">unsafe impl </span>ClassType <span class="kw">for </span>MyClass {
        <span class="kw">type </span>Super = NSObject;
        <span class="kw">const </span>NAME: <span class="kw-2">&amp;</span><span class="lifetime">'static </span>str = <span class="string">"MyClass"</span>;
    }
);
</code></pre></div>
</li>
<li>
<p>Updated <code>ffi</code> module to <code>objc-sys v0.3.0</code>.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Updated <code>encode</code> module to <code>objc2-encode v2.0.0-pre.4</code>.</p>
</li>
</ul>
<h4 id="fixed-3"><a class="doc-anchor" href="#fixed-3">§</a>Fixed</h4>
<ul>
<li>Allow empty structs in <code>declare_class!</code> macro.</li>
<li>Allow using <code>extern_methods!</code> without the <code>ClassType</code> trait in scope.</li>
<li>Fixed a few small issues with <code>declare_class!</code>.</li>
<li>Fixed <code>()</code> being possible in argument position in <code>msg_send!</code>.</li>
</ul>
<h3 id="030-beta4---2022-12-24"><a class="doc-anchor" href="#030-beta4---2022-12-24">§</a>0.3.0-beta.4 - 2022-12-24</h3><h4 id="added-6"><a class="doc-anchor" href="#added-6">§</a>Added</h4>
<ul>
<li>
<p>Allow directly specifying class name in <code>extern_class!</code> macro.</p>
</li>
<li>
<p>Added <code>ClassType::alloc</code>.</p>
<p>This means you can now simplify your code as follows:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// Before
</span><span class="kw">let </span>obj: Id&lt;NSObject, Shared&gt; = <span class="kw">unsafe </span>{
    <span class="macro">msg_send_id!</span>[<span class="macro">msg_send_id!</span>[NSObject::class(), alloc], init]
};

<span class="comment">// After
</span><span class="kw">let </span>obj: Id&lt;NSObject, Shared&gt; = <span class="kw">unsafe </span>{
    <span class="macro">msg_send_id!</span>[NSObject::alloc(), init]
};</code></pre></div>
</li>
<li>
<p>Added <code>Class::class_method</code>.</p>
</li>
<li>
<p>Added the ability to specify <code>error: _</code>, <code>somethingReturningError: _</code> and
so on at the end of <code>msg_send!</code>/<code>msg_send_id!</code>, and have it automatically
return a <code>Result&lt;..., Id&lt;NSError, Shared&gt;&gt;</code>.</p>
</li>
<li>
<p>Added the ability to specify an extra parameter at the end of the selector
in methods declared with <code>extern_methods!</code>, and let that be the <code>NSError**</code>
parameter.</p>
</li>
<li>
<p>Added <code>#[method_id(...)]</code> attribute to <code>extern_methods!</code>.</p>
</li>
<li>
<p>Added <code>"verify"</code> feature as a replacement for the <code>"verify_message"</code>
feature.</p>
</li>
<li>
<p>Added <code>extern_protocol!</code> macro and <code>ProtocolType</code> trait.</p>
</li>
<li>
<p>Added <code>ConformsTo</code> trait for marking that a type conforms to a specific
protocol.</p>
</li>
<li>
<p>Added <code>Encode</code> impl for <code>Option&lt;Sel&gt;</code>.</p>
</li>
<li>
<p>Added <code>objc2::runtime::NSObject</code> - before, this was only available under
<code>objc2::foundation::NSObject</code>.</p>
</li>
<li>
<p>Added <code>objc2::runtime::NSZone</code> - before, this was only available under
<code>objc2::foundation::NSZone</code>.</p>
</li>
</ul>
<h4 id="changed-6"><a class="doc-anchor" href="#changed-6">§</a>Changed</h4>
<ul>
<li>Allow other types than <code>&amp;Class</code> as the receiver in <code>msg_send_id!</code> methods
of the <code>new</code> family.</li>
<li><strong>BREAKING</strong>: Changed the <code>Allocated</code> struct to be used as <code>Allocated&lt;T&gt;</code>
instead of <code>Id&lt;Allocated&lt;T&gt;, O&gt;</code>.</li>
<li>Verify the message signature of overriden methods when declaring classes if
the <code>verify</code> feature is enabled.</li>
<li>Verify in <code>declare_class!</code> that protocols are implemented correctly.</li>
<li><strong>BREAKING</strong>: Changed the name of the attribute macro in <code>extern_methods</code>
from <code>#[sel(...)]</code> to <code>#[method(...)]</code>.</li>
<li><strong>BREAKING</strong>: Changed <code>extern_methods!</code> and <code>declare_class!</code> such that
associated functions whoose first parameter is called <code>this</code>, is treated as
instance methods instead of class methods.</li>
<li><strong>BREAKING</strong>: Message verification is now enabled by default. Your message
sends might panic with <code>debug_assertions</code> enabled if they are detected to
be invalid. Test your code to see if that is the case!</li>
<li><strong>BREAKING</strong>: <code>declare_class!</code> uses <code>ConformsTo&lt;...&gt;</code> instead of the
temporary <code>Protocol&lt;...&gt;</code> syntax.</li>
<li>Require implementors of <code>Message</code> to support weak references.</li>
<li><strong>BREAKING</strong>: Moved <code>objc2::foundation</code> into <code>icrate::Foundation</code>.</li>
<li><strong>BREAKING</strong>: Moved <code>objc2::ns_string</code> into <code>icrate::ns_string</code>.</li>
<li>Updated <code>ffi</code> module to <code>objc-sys v0.2.0-beta.3</code>.</li>
<li><strong>BREAKING</strong>: Updated <code>encode</code> module <code>objc2-encode v2.0.0-pre.3</code>.</li>
</ul>
<h4 id="fixed-4"><a class="doc-anchor" href="#fixed-4">§</a>Fixed</h4>
<ul>
<li>Fixed duplicate selector extraction in <code>extern_methods!</code>.</li>
<li>Fixed using <code>deprecated</code> attributes in <code>declare_class!</code>.</li>
<li>Fixed <code>cfg</code> attributes on methods and implementations in <code>declare_class!</code>.</li>
</ul>
<h4 id="removed-2"><a class="doc-anchor" href="#removed-2">§</a>Removed</h4>
<ul>
<li><strong>BREAKING</strong>: Removed <code>"verify_message"</code> feature. It has been mostly
replaced by <code>debug_assertions</code> and the <code>"verify"</code> feature.</li>
</ul>
<h3 id="030-beta3---2022-09-01"><a class="doc-anchor" href="#030-beta3---2022-09-01">§</a>0.3.0-beta.3 - 2022-09-01</h3><h4 id="added-7"><a class="doc-anchor" href="#added-7">§</a>Added</h4>
<ul>
<li>Added <code>Ivar::write</code>, <code>Ivar::as_ptr</code> and <code>Ivar::as_mut_ptr</code> for safely
querying and modifying instance variables inside <code>init</code> methods.</li>
<li>Added <code>IvarDrop&lt;T&gt;</code> to allow storing complex <code>Drop</code> values in ivars
(currently <code>rc::Id&lt;T, O&gt;</code>, <code>Box&lt;T&gt;</code>, <code>Option&lt;rc::Id&lt;T, O&gt;&gt;</code> or
<code>Option&lt;Box&lt;T&gt;&gt;</code>).</li>
<li><strong>BREAKING</strong>: Added required <code>ClassType::NAME</code> constant for statically
determining the name of a specific class.</li>
<li>Allow directly specifying class name in <code>declare_class!</code> macro.</li>
</ul>
<h4 id="removed-3"><a class="doc-anchor" href="#removed-3">§</a>Removed</h4>
<ul>
<li><strong>BREAKING</strong>: <code>MaybeUninit</code> no longer implements <code>IvarType</code> directly; use
<code>Ivar::write</code> instead.</li>
</ul>
<h3 id="030-beta2---2022-08-28"><a class="doc-anchor" href="#030-beta2---2022-08-28">§</a>0.3.0-beta.2 - 2022-08-28</h3><h4 id="added-8"><a class="doc-anchor" href="#added-8">§</a>Added</h4>
<ul>
<li>
<p>Added the <code>"unstable-static-class"</code> and <code>"unstable-static-class-inlined"</code>
feature flags to make the <code>class!</code> macro zero cost.</p>
</li>
<li>
<p>Moved the external crate <code>objc2_foundation</code> into <code>objc2::foundation</code> under
(default) feature flag <code>"foundation"</code>.</p>
</li>
<li>
<p>Added <code>declare_class!</code>, <code>extern_class!</code> and <code>ns_string!</code> macros from
<code>objc2-foundation</code>.</p>
</li>
<li>
<p>Added helper method <code>ClassBuilder::add_static_ivar</code>.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Added <code>ClassType</code> trait, and moved the associated <code>class</code>
methods that <code>extern_class!</code> and <code>declare_class!</code> generated to that. This
means you’ll have to <code>use objc2::ClassType</code> whenever you want to use e.g.
<code>NSData::class()</code>.</p>
</li>
<li>
<p>Added <code>Id::into_super</code>.</p>
</li>
<li>
<p>Added <code>extern_methods!</code> macro.</p>
</li>
<li>
<p>Added ability to call <code>msg_send![super(obj), ...]</code> without explicitly
specifying the superclass.</p>
</li>
<li>
<p>Added automatic conversion of <code>bool</code> to/from the Objective-C <code>BOOL</code> in
<code>msg_send!</code>, <code>msg_send_id!</code>, <code>extern_methods!</code> and <code>declare_class!</code>.</p>
<p>Example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// Before
</span><span class="kw">use </span>objc2::{msg_send, msg_send_bool};
<span class="kw">use </span>objc2::rc::{Id, Shared};
<span class="kw">use </span>objc2::runtime::{Bool, Object};

<span class="kw">let </span>obj: Id&lt;Object, Shared&gt;;
<span class="kw">let _</span>: () = <span class="kw">unsafe </span>{ <span class="macro">msg_send!</span>[<span class="kw-2">&amp;</span>obj, setArg: Bool::YES] };
<span class="kw">let </span>is_equal = <span class="kw">unsafe </span>{ <span class="macro">msg_send_bool!</span>[<span class="kw-2">&amp;</span>obj, isEqual: <span class="kw-2">&amp;*</span>obj] };

<span class="comment">// After
</span><span class="kw">use </span>objc2::msg_send;
<span class="kw">use </span>objc2::rc::{Id, Shared};
<span class="kw">use </span>objc2::runtime::Object;

<span class="kw">let </span>obj: Id&lt;Object, Shared&gt;;
<span class="kw">let _</span>: () = <span class="kw">unsafe </span>{ <span class="macro">msg_send!</span>[<span class="kw-2">&amp;</span>obj, setArg: <span class="bool-val">true</span>] };
<span class="kw">let </span>is_equal: bool = <span class="kw">unsafe </span>{ <span class="macro">msg_send!</span>[<span class="kw-2">&amp;</span>obj, isEqual: <span class="kw-2">&amp;*</span>obj] };</code></pre></div>
</li>
</ul>
<h4 id="changed-7"><a class="doc-anchor" href="#changed-7">§</a>Changed</h4>
<ul>
<li>
<p><strong>BREAKING</strong>: Change syntax in <code>extern_class!</code> macro to be more Rust-like.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Change syntax in <code>declare_class!</code> macro to be more Rust-like.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Renamed <code>Id::from_owned</code> to <code>Id::into_shared</code>.</p>
</li>
<li>
<p><strong>BREAKING</strong>: The return type of <code>msg_send_id!</code> is now more generic; it can
now either be <code>Option&lt;Id&lt;_, _&gt;&gt;</code> or <code>Id&lt;_, _&gt;</code> (if the latter, it’ll panic
if the method returned <code>NULL</code>).</p>
<p>Example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// Before
</span><span class="kw">let </span>obj: Id&lt;Object, Shared&gt; = <span class="kw">unsafe </span>{
    <span class="macro">msg_send_id!</span>[<span class="macro">msg_send_id!</span>[<span class="macro">class!</span>(MyObject), alloc], init].unwrap()
};

<span class="comment">// After
</span><span class="kw">let </span>obj: Id&lt;Object, Shared&gt; = <span class="kw">unsafe </span>{
    <span class="macro">msg_send_id!</span>[<span class="macro">msg_send_id!</span>[<span class="macro">class!</span>(MyObject), alloc], init]
};</code></pre></div>
</li>
<li>
<p>Updated <code>ffi</code> module to <code>objc-sys v0.2.0-beta.2</code>.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Updated <code>encode</code> module <code>objc2-encode v2.0.0-pre.2</code>.</p>
<p>In particular, <code>Encoding</code> no longer has a lifetime parameter:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// Before
</span><span class="attr">#[repr(C)]
</span><span class="kw">pub struct </span>NSRange {
    <span class="kw">pub </span>location: usize,
    <span class="kw">pub </span>length: usize,
}
<span class="kw">unsafe impl </span>Encode <span class="kw">for </span>NSRange {
    <span class="kw">const </span>ENCODING: Encoding&lt;<span class="lifetime">'static</span>&gt; = Encoding::Struct(
        <span class="string">"_NSRange"</span>, <span class="comment">// This is how the struct is defined in C header files
        </span><span class="kw-2">&amp;</span>[usize::ENCODING, usize::ENCODING]
    );
}
<span class="kw">unsafe impl </span>RefEncode <span class="kw">for </span>NSRange {
    <span class="kw">const </span>ENCODING_REF: Encoding&lt;<span class="lifetime">'static</span>&gt; = Encoding::Pointer(<span class="kw-2">&amp;</span><span class="self">Self</span>::ENCODING);
}

<span class="comment">// After
</span><span class="attr">#[repr(C)]
</span><span class="kw">pub struct </span>NSRange {
    <span class="kw">pub </span>location: usize,
    <span class="kw">pub </span>length: usize,
}
<span class="kw">unsafe impl </span>Encode <span class="kw">for </span>NSRange {
    <span class="kw">const </span>ENCODING: Encoding = Encoding::Struct(
        <span class="string">"_NSRange"</span>, <span class="comment">// This is how the struct is defined in C header files
        </span><span class="kw-2">&amp;</span>[usize::ENCODING, usize::ENCODING]
    );
}
<span class="kw">unsafe impl </span>RefEncode <span class="kw">for </span>NSRange {
    <span class="kw">const </span>ENCODING_REF: Encoding = Encoding::Pointer(<span class="kw-2">&amp;</span><span class="self">Self</span>::ENCODING);
}</code></pre></div>
</li>
</ul>
<h4 id="deprecated-2"><a class="doc-anchor" href="#deprecated-2">§</a>Deprecated</h4>
<ul>
<li>Depreacted <code>msg_send_bool!</code> in favour of new functionality on <code>msg_send!</code>
that allows seamlessly handling <code>bool</code>.</li>
</ul>
<h3 id="030-beta1---2022-07-19"><a class="doc-anchor" href="#030-beta1---2022-07-19">§</a>0.3.0-beta.1 - 2022-07-19</h3><h4 id="added-9"><a class="doc-anchor" href="#added-9">§</a>Added</h4>
<ul>
<li>
<p>Added <code>msg_send_id!</code> to help with following Objective-C’s memory management
rules. <strong>It is highly recommended that you use this instead of doing memory
management yourself!</strong></p>
<p>Example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// Before
</span><span class="kw">let </span>obj: Id&lt;Object, Shared&gt; = <span class="kw">unsafe </span>{
    <span class="kw">let </span>obj: <span class="kw-2">*mut </span>Object = <span class="macro">msg_send!</span>[<span class="macro">class!</span>(MyObject), alloc];
    <span class="kw">let </span>obj: <span class="kw-2">*mut </span>Object = <span class="macro">msg_send!</span>[obj, init];
    Id::new(obj).unwrap()
};

<span class="comment">// After
</span><span class="kw">let </span>obj: Id&lt;Object, Shared&gt; = <span class="kw">unsafe </span>{
    <span class="macro">msg_send_id!</span>[<span class="macro">msg_send_id!</span>[<span class="macro">class!</span>(MyObject), alloc], init].unwrap()
};</code></pre></div>
</li>
<li>
<p>Added the <code>"unstable-static-sel"</code> and <code>"unstable-static-sel-inlined"</code>
feature flags to make the <code>sel!</code> macro (and by extension, the <code>msg_send!</code>
macros) faster.</p>
</li>
<li>
<p>Added <code>"unstable-c-unwind"</code> feature.</p>
</li>
<li>
<p>Added unsafe function <code>Id::cast</code> for converting between different types of
objects.</p>
</li>
<li>
<p>Added <code>Object::ivar_ptr</code> to allow direct access to instance variables
through <code>&amp;Object</code>.</p>
</li>
<li>
<p>Added <code>VerificationError</code> as more specific return type from
<code>Class::verify_sel</code>.</p>
</li>
<li>
<p>Added <code>rc::Allocated</code> struct which is used within <code>msg_send_id!</code>.</p>
</li>
<li>
<p>Added <code>Class::responds_to</code>.</p>
</li>
<li>
<p>Added <code>exception::Exception</code> object to improve error messages from caught
exceptions.</p>
</li>
<li>
<p>Added <code>declare::Ivar&lt;T&gt;</code> helper struct. This is useful for building safe
abstractions that access instance variables.</p>
</li>
<li>
<p>Added <code>Id::from_owned</code> helper function.</p>
</li>
</ul>
<h4 id="changed-8"><a class="doc-anchor" href="#changed-8">§</a>Changed</h4>
<ul>
<li>
<p><strong>BREAKING</strong>: <code>Sel</code> is now required to be non-null, which means that you
have to ensure that any selectors you receive from method calls are
non-null before using them.</p>
</li>
<li>
<p><strong>BREAKING</strong>: <code>ClassBuilder::root</code> is now generic over the function pointer,
meaning you will have to coerce initializer functions to pointers like in
<code>ClassBuilder::add_method</code> before you can use it.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Moved <code>MessageReceiver::verify_message</code> to <code>Class::verify_sel</code>
and changed return type.</p>
</li>
<li>
<p>Improved debug output with <code>verify_message</code> feature enabled.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Changed <code>MessageReceiver::send_message</code> to panic instead of
returning an error.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Renamed <code>catch_all</code> feature to <code>catch-all</code>.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Made passing the function pointer argument to
<code>ClassBuilder::add_method</code>, <code>ClassBuilder::add_class_method</code> and similar
more ergonomic.</p>
<p>Let’s say you have the following code:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// Before
</span><span class="kw">let </span>init: <span class="kw">extern </span><span class="string">"C" </span><span class="kw">fn</span>(<span class="kw-2">&amp;mut </span>Object, Sel) -&gt; <span class="kw-2">*mut </span>Object = init;
builder.add_method(<span class="macro">sel!</span>(init), init);</code></pre></div>
<p>Unfortunately, you will now encounter a very confusing error:</p>
<div class="example-wrap"><pre class="language-text"><code>  |
2 | builder.add_method(sel!(init), init);
  |         ^^^^^^^^^^ implementation of `MethodImplementation` is not general enough
  |
   = note: `MethodImplementation` would have to be implemented for the type `for&lt;&#39;r&gt; extern &quot;C&quot; fn(&amp;&#39;r mut Object, Sel) -&gt; *mut Object`
   = note: ...but `MethodImplementation` is actually implemented for the type `extern &quot;C&quot; fn(&amp;&#39;0 mut Object, Sel) -&gt; *mut Object`, for some specific lifetime `&#39;0`
</code></pre></div>
<p>To fix this, let the compiler infer the argument and return types:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// After
</span><span class="kw">let </span>init: <span class="kw">extern </span><span class="string">"C" </span><span class="kw">fn</span>(<span class="kw">_</span>, <span class="kw">_</span>) -&gt; <span class="kw">_ </span>= init;
builder.add_method(<span class="macro">sel!</span>(init), init);</code></pre></div>
</li>
<li>
<p>Updated <code>ffi</code> module to <code>objc-sys v0.2.0-beta.1</code>.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Updated <code>encode</code> module <code>objc2-encode v2.0.0-pre.1</code>.</p>
</li>
</ul>
<h4 id="fixed-5"><a class="doc-anchor" href="#fixed-5">§</a>Fixed</h4>
<ul>
<li><strong>BREAKING</strong>: Disallow throwing <code>nil</code> exceptions in <code>exception::throw</code>.</li>
</ul>
<h4 id="removed-4"><a class="doc-anchor" href="#removed-4">§</a>Removed</h4>
<ul>
<li><strong>BREAKING</strong>: Removed the <code>Sel::from_ptr</code> method.</li>
<li><strong>BREAKING</strong>: Removed <code>MessageError</code>.</li>
</ul>
<h3 id="030-beta0---2022-06-13"><a class="doc-anchor" href="#030-beta0---2022-06-13">§</a>0.3.0-beta.0 - 2022-06-13</h3><h4 id="added-10"><a class="doc-anchor" href="#added-10">§</a>Added</h4>
<ul>
<li>Added deprecated <code>Object::get_ivar</code> and <code>Object::get_mut_ivar</code> to make
upgrading easier.</li>
<li>Allow using <code>From</code>/<code>TryFrom</code> to convert between <code>rc::Id</code> and <code>rc::WeakId</code>.</li>
<li>Added <code>Bool::as_bool</code> (more descriptive name than <code>Bool::is_true</code>).</li>
<li>Added convenience method <code>Id::as_ptr</code> and <code>Id::as_mut_ptr</code>.</li>
<li>The <code>objc2-encode</code> dependency is now exposed as <code>objc2::encode</code>.</li>
<li>Added <code>Id::retain_autoreleased</code> to allow following Cocoas memory management
rules more efficiently.</li>
<li>Consistently allow trailing commas in <code>msg_send!</code>.</li>
<li>Added <code>msg_send_bool!</code>, a less error-prone version of <code>msg_send!</code> for
Objective-C methods that return <code>BOOL</code>.</li>
<li>Implemented <code>MethodImplementation</code> for <code>unsafe</code> function pointers.</li>
</ul>
<h4 id="changed-9"><a class="doc-anchor" href="#changed-9">§</a>Changed</h4>
<ul>
<li>
<p><strong>BREAKING</strong>: Changed signature of <code>Id::new</code> and <code>Id::retain</code> from
<code>fn(NonNull&lt;T&gt;) -&gt; Id&lt;T&gt;</code> to <code>fn(*mut T) -&gt; Option&lt;Id&lt;T&gt;&gt;</code>.</p>
<p>Concretely, you will have to change your code as follows.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// Before
</span><span class="kw">let </span>obj: <span class="kw-2">*mut </span>Object = <span class="kw">unsafe </span>{ <span class="macro">msg_send!</span>[<span class="macro">class!</span>(NSObject), new] };
<span class="kw">let </span>obj = NonNull::new(obj).expect(<span class="string">"Failed to allocate object."</span>);
<span class="kw">let </span>obj = <span class="kw">unsafe </span>{ Id::new(obj) };
<span class="comment">// After
</span><span class="kw">let </span>obj: <span class="kw-2">*mut </span>Object = <span class="kw">unsafe </span>{ <span class="macro">msg_send!</span>[<span class="macro">class!</span>(NSObject), new] };
<span class="kw">let </span>obj = <span class="kw">unsafe </span>{ Id::new(obj) }.expect(<span class="string">"Failed to allocate object."</span>);</code></pre></div>
</li>
<li>
<p>Allow specifying any receiver <code>T: Message</code> for methods added with
<code>ClassBuilder::add_method</code>.</p>
</li>
<li>
<p>Renamed <code>ClassDecl</code> and <code>ProtocolDecl</code> to <code>ClassBuilder</code> and
<code>ProtocolBuilder</code>. The old names are kept as deprecated aliases.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Changed how <code>msg_send!</code> works wrt. capturing its arguments.</p>
<p>This will require changes to your code wherever you used <code>Id</code>, for example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// Before
</span><span class="kw">let </span>obj: Id&lt;Object, Owned&gt; = ...;
<span class="kw">let </span>p: i32 = <span class="kw">unsafe </span>{ <span class="macro">msg_send!</span>[obj, parameter] };
<span class="kw">let _</span>: () = <span class="kw">unsafe </span>{ <span class="macro">msg_send!</span>[obj, setParameter: p + <span class="number">1</span>] };
<span class="comment">// After
</span><span class="kw">let </span><span class="kw-2">mut </span>obj: Id&lt;Object, Owned&gt; = ...;
<span class="kw">let </span>p: i32 = <span class="kw">unsafe </span>{ <span class="macro">msg_send!</span>[<span class="kw-2">&amp;</span>obj, parameter] };
<span class="kw">let _</span>: () = <span class="kw">unsafe </span>{ <span class="macro">msg_send!</span>[<span class="kw-2">&amp;mut </span>obj, setParameter: p + <span class="number">1</span>] };</code></pre></div>
<p>Notice that we now clearly pass <code>obj</code> by reference, and therein also
communicate the mutability of the object (in the first case, immutable, and
in the second, mutable).</p>
<p>If you previously used <code>*mut Object</code> or <code>&amp;Object</code> as the receiver, message
sending should work exactly as before.</p>
</li>
<li>
<p><strong>BREAKING</strong>: <code>Class</code> no longer implements <code>Message</code> (but it can still be
used as the receiver in <code>msg_send!</code>, so this is unlikely to break anything
in practice).</p>
</li>
<li>
<p><strong>BREAKING</strong>: Sealed the <code>MethodImplementation</code> trait, and made its <code>imp</code>
method privat.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Updated <code>ffi</code> module to <code>objc-sys v0.2.0-beta.0</code>.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Updated <code>objc2-encode</code> (<code>Encoding</code>, <code>Encode</code>, <code>RefEncode</code> and
<code>EncodeArguments</code>) to <code>v2.0.0-pre.0</code>.</p>
</li>
</ul>
<h4 id="fixed-6"><a class="doc-anchor" href="#fixed-6">§</a>Fixed</h4>
<ul>
<li>Properly sealed the <code>MessageArguments</code> trait (it already had a hidden
method, so this is not really a breaking change).</li>
</ul>
<h4 id="removed-5"><a class="doc-anchor" href="#removed-5">§</a>Removed</h4>
<ul>
<li><strong>BREAKING</strong>: <code>ManuallyDrop</code> no longer implements <code>Message</code> directly.</li>
<li><strong>BREAKING</strong>: <code>MessageReceiver::as_raw_receiver</code> is no longer public.</li>
</ul>
<h3 id="030-alpha6---2022-01-03"><a class="doc-anchor" href="#030-alpha6---2022-01-03">§</a>0.3.0-alpha.6 - 2022-01-03</h3><h4 id="added-11"><a class="doc-anchor" href="#added-11">§</a>Added</h4>
<ul>
<li>Implement <code>Hash</code> for <code>Sel</code>, <code>Ivar</code>, <code>Class</code>, <code>Method</code> and <code>MessageError</code>.</li>
<li>Implement <code>PartialEq</code> and <code>Eq</code> for <code>Ivar</code>, <code>Method</code> and <code>MessageError</code>.</li>
<li>Implement <code>fmt::Pointer</code> for <code>Sel</code> and <code>rc::AutoreleasePool</code>.</li>
<li>Implement <code>fmt::Debug</code> for <code>ClassDecl</code>, <code>ProtocolDecl</code> and <code>rc::AutoreleasePool</code>.</li>
</ul>
<h4 id="changed-10"><a class="doc-anchor" href="#changed-10">§</a>Changed</h4>
<ul>
<li><strong>BREAKING</strong>: Renamed:
<ul>
<li><code>Object::get_ivar</code> -&gt; <code>Object::ivar</code></li>
<li><code>Object::get_mut_ivar</code> -&gt; <code>Object::ivar_mut</code></li>
</ul>
</li>
<li>Vastly improved documentation.</li>
<li><strong>BREAKING</strong>: Updated <code>ffi</code> module to <code>objc-sys v0.2.0-alpha.1</code>.</li>
<li><strong>BREAKING</strong>: Updated <code>objc2-encode</code> (<code>Encoding</code>, <code>Encode</code>, <code>RefEncode</code> and
<code>EncodeArguments</code>) to <code>v2.0.0-beta.2</code>.</li>
</ul>
<h3 id="030-alpha5---2021-12-22"><a class="doc-anchor" href="#030-alpha5---2021-12-22">§</a>0.3.0-alpha.5 - 2021-12-22</h3><h4 id="added-12"><a class="doc-anchor" href="#added-12">§</a>Added</h4>
<ul>
<li>Export <code>objc-sys</code> as <code>ffi</code> module.</li>
<li>Added common trait impls on <code>rc::Owned</code> and <code>rc::Shared</code> (useful in generic
contexts).</li>
<li>Implement <code>RefEncode</code> for <code>runtime::Protocol</code>.</li>
<li>Added <code>Message</code> and <code>MessageReceiver</code> implementation for <code>ManuallyDrop&lt;T&gt;</code>
(where <code>T</code> is appropriately bound). This allows patterns like:
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>obj = Id::new(<span class="macro">msg_send!</span>[<span class="macro">class!</span>(MyObject), alloc]);
<span class="kw">let </span>obj = ManuallyDrop::new(obj);
<span class="comment">// `init` takes ownership and possibly returns a new object.
</span><span class="kw">let </span>obj = Id::new(<span class="macro">msg_send!</span>[obj, init]);</code></pre></div>
</li>
<li>New cargo feature <code>"malloc"</code>, which allows cutting down on dependencies,
most crates don’t need the introspection features that this provides.</li>
</ul>
<h4 id="changed-11"><a class="doc-anchor" href="#changed-11">§</a>Changed</h4>
<ul>
<li>Deprecated <code>runtime::BOOL</code>, <code>runtime::YES</code> and <code>runtime::NO</code>. Use the
newtype <code>Bool</code> instead, or low-level <code>ffi::BOOL</code>, <code>ffi::YES</code> and <code>ffi::NO</code>.</li>
<li><strong>BREAKING</strong>: The following methods now require the new <code>"malloc"</code> feature
flag to be enabled:
<ul>
<li><code>MessageReceiver::verify_message</code> (temporarily)</li>
<li><code>Method::return_type</code></li>
<li><code>Method::argument_type</code></li>
<li><code>Class::classes</code></li>
<li><code>Class::instance_methods</code></li>
<li><code>Class::adopted_protocols</code></li>
<li><code>Class::instance_variables</code></li>
<li><code>Protocol::protocols</code></li>
<li><code>Protocol::adopted_protocols</code></li>
</ul>
</li>
<li>Relaxed <code>Sized</code> bound on <code>rc::Id</code> and <code>rc::WeakId</code> to prepare for
<code>extern type</code> support.</li>
<li><strong>BREAKING</strong>: Relaxed <code>Sized</code> bound on <code>rc::SliceId</code> and <code>rc::DefaultId</code>.</li>
<li><strong>BREAKING</strong>: Updated <code>objc-sys</code> to <code>v0.2.0-alpha.0</code>.</li>
<li>Updated <code>objc2-encode</code> (<code>Encoding</code>, <code>Encode</code>, <code>RefEncode</code> and
<code>EncodeArguments</code>) to <code>v2.0.0-beta.1</code>.</li>
</ul>
<h4 id="removed-6"><a class="doc-anchor" href="#removed-6">§</a>Removed</h4>
<ul>
<li><strong>BREAKING</strong>: Removed the raw FFI functions from the <code>runtime</code> module. These
are available in the new <code>ffi</code> module instead.</li>
</ul>
<h4 id="fixed-7"><a class="doc-anchor" href="#fixed-7">§</a>Fixed</h4>
<ul>
<li>An issue with inlining various <code>rc</code> methods.</li>
<li>Most types (e.g. <code>Class</code> and <code>Method</code>) are now <code>Send</code>, <code>Sync</code>, <code>UnwindSafe</code>
and <code>RefUnwindSafe</code> again.
Notable exception is <code>Object</code>, because that depends on the specific
subclass.</li>
</ul>
<h3 id="030-alpha4---2021-11-22"><a class="doc-anchor" href="#030-alpha4---2021-11-22">§</a>0.3.0-alpha.4 - 2021-11-22</h3>
<p>Note: To use this version, specify <code>objc2-encode = "=2.0.0-beta.0"</code> in your
<code>Cargo.toml</code> as well.</p>
<h4 id="added-13"><a class="doc-anchor" href="#added-13">§</a>Added</h4>
<ul>
<li><strong>BREAKING</strong>: GNUStep users must depend on, and specify the appropriate
feature flag on <code>objc-sys</code> for the version they’re using.</li>
<li>Moved <code>objc_exception</code> crate into <code>exception</code> module (under feature flag).</li>
<li>Added support for <code>_Complex</code> types.</li>
<li>Added <code>rc::SliceId</code>, <code>rc::SliceIdMut</code> and <code>rc::DefaultId</code> helper traits for
extra functionality on <code>rc::Id</code>.</li>
</ul>
<h4 id="changed-12"><a class="doc-anchor" href="#changed-12">§</a>Changed</h4>
<ul>
<li><strong>BREAKING</strong>: The <code>exception</code> feature now only enables the <code>exception</code>
module, for general use. Use the new <code>catch_all</code> feature to wrap all message
sends in a <code>@try/@catch</code>.</li>
<li><strong>BREAKING</strong>: Updated <code>objc-sys</code> to <code>v0.1.0</code>.</li>
<li><strong>BREAKING</strong>: Updated <code>objc2-encode</code> (<code>Encoding</code>, <code>Encode</code>, <code>RefEncode</code> and
<code>EncodeArguments</code>) to <code>v2.0.0-beta.0</code>.</li>
</ul>
<h3 id="030-alpha3---2021-09-05"><a class="doc-anchor" href="#030-alpha3---2021-09-05">§</a>0.3.0-alpha.3 - 2021-09-05</h3>
<p>Note: To use this version, specify <code>objc2-encode = "=2.0.0-alpha.1"</code> in your
<code>Cargo.toml</code> as well.</p>
<h4 id="added-14"><a class="doc-anchor" href="#added-14">§</a>Added</h4>
<ul>
<li>Now uses the <code>objc-sys</code> (<code>v0.0.1</code>) crate for possibly better
interoperability with other crates that link to <code>libobjc</code>.</li>
<li>Added newtype <code>runtime::Bool</code> to fix soundness issues with using
<code>runtime::BOOL</code> or <code>bool</code>.</li>
<li>Moved <code>objc_id</code> crate into <code>rc</code> module. Notable changes:
<ul>
<li>Vastly improved documentation</li>
<li>Added <code>Id::autorelease</code></li>
<li>Added <code>Id::from_shared</code></li>
<li>Added a lot of forwarding implementations on <code>Id</code> for easier use</li>
<li><code>Id</code> and <code>WeakId</code> are now able to use the null-pointer optimization</li>
<li><strong>BREAKING</strong>: Added <code>T: Message</code> bounds on <code>Id</code></li>
<li><strong>BREAKING</strong>: Remove <code>ShareId</code> type alias</li>
<li><strong>BREAKING</strong>: <code>Id</code> no longer have a default <code>Ownership</code>, you must specify
it everywhere as either <code>Id&lt;T, Shared&gt;</code> or <code>Id&lt;T, Owned&gt;</code></li>
<li><strong>BREAKING</strong>: Sealed the <code>Ownership</code> trait</li>
<li><strong>BREAKING</strong>: Renamed <code>Id::from_ptr</code> to <code>Id::retain</code></li>
<li><strong>BREAKING</strong>: Renamed <code>Id::from_retained_ptr</code> to <code>Id::new</code></li>
<li><strong>BREAKING</strong>: Changed <code>Id::share</code> to a <code>From</code> implementation (usage of
<code>obj.share()</code> can be changed to <code>obj.into()</code>)</li>
<li><strong>BREAKING</strong>: Fixed soundness issues with missing <code>Send</code> and <code>Sync</code> bounds
on <code>Id</code> and <code>WeakId</code></li>
</ul>
</li>
<li>Added sealed (for now) trait <code>MessageReceiver</code> to specify types that can
be used as the receiver of a message (instead of only allowing pointer
types).</li>
<li>Add <code>MessageReceiver::send_super_message</code> method for dynamic selectors.</li>
</ul>
<h4 id="changed-13"><a class="doc-anchor" href="#changed-13">§</a>Changed</h4>
<ul>
<li><strong>BREAKING</strong>: Change types of parameters to FFI functions exported in the
<code>runtime</code> module.</li>
<li><strong>BREAKING</strong>: Most types are now <code>!UnwindSafe</code>, to discourage trying to use
them after an unwind. This restriction may be lifted in the future.</li>
<li><strong>BREAKING</strong>: Most types are now <code>!Send</code> and <code>!Sync</code>. This was an oversight
that is fixed in a later version.</li>
<li>A lot of smaller things.</li>
<li><strong>BREAKING</strong>: Dynamic message sending with <code>Message::send_message</code> is moved
to <code>MessageReceiver</code>.</li>
<li><strong>BREAKING</strong> Make <code>MessageArguments</code> a subtrait of <code>EncodeArguments</code>.</li>
<li>Allow an optional comma after each argument to <code>msg_send!</code>.</li>
</ul>
<h4 id="removed-7"><a class="doc-anchor" href="#removed-7">§</a>Removed</h4>
<ul>
<li><strong>BREAKING</strong>: Removed <code>rc::StrongPtr</code>. Use <code>Option&lt;rc::Id&lt;Object, Shared&gt;&gt;</code>
instead (beware: This has stronger safety invariants!).</li>
<li><strong>BREAKING</strong>: Removed <code>rc::WeakPtr</code>. Use <code>rc::WeakId&lt;Object&gt;</code> instead.</li>
</ul>
<h4 id="fixed-8"><a class="doc-anchor" href="#fixed-8">§</a>Fixed</h4>
<ul>
<li><strong>BREAKING</strong>: Stop unsafely dereferencing <code>msg_send!</code>s first argument. The
<code>MessageReceiver</code> trait was introduced to avoid most breakage from this
change.</li>
</ul>
<h3 id="030-alpha2---2021-09-05"><a class="doc-anchor" href="#030-alpha2---2021-09-05">§</a>0.3.0-alpha.2 - 2021-09-05</h3><h4 id="added-15"><a class="doc-anchor" href="#added-15">§</a>Added</h4>
<ul>
<li>Added <code>rc::AutoreleasePool</code> and <code>rc::AutoreleaseSafe</code> to make accessing
autoreleased objects safe, by binding references to it using the
<code>ptr_as_ref</code> and <code>ptr_as_mut</code> methods.</li>
</ul>
<h4 id="changed-14"><a class="doc-anchor" href="#changed-14">§</a>Changed</h4>
<ul>
<li>
<p><strong>BREAKING</strong>: The closure in <code>rc::autoreleasepool</code> now takes an argument
<code>&amp;rc::AutoreleasePool</code>. This reference can be given to functions like
<code>INSString::as_str</code> so that it knows which lifetime to bound the returned
<code>&amp;str</code> with.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// Before
</span>autoreleasepool(|| {
    <span class="comment">// Some code that autoreleases objects
</span>});

<span class="comment">// After
</span>autoreleasepool(|_pool| {
    <span class="comment">// Some code that autoreleases objects
</span>});</code></pre></div>
</li>
</ul>
<h4 id="fixed-9"><a class="doc-anchor" href="#fixed-9">§</a>Fixed</h4>
<ul>
<li>The encoding of <code>BOOL</code> on <code>GNUStep</code>.</li>
</ul>
<h3 id="030-alpha1---2021-09-02"><a class="doc-anchor" href="#030-alpha1---2021-09-02">§</a>0.3.0-alpha.1 - 2021-09-02</h3><h4 id="added-16"><a class="doc-anchor" href="#added-16">§</a>Added</h4>
<ul>
<li>More documentation of safety requirements, and in general.</li>
</ul>
<h4 id="changed-15"><a class="doc-anchor" href="#changed-15">§</a>Changed</h4>
<ul>
<li>
<p><strong>BREAKING</strong>: Change <code>objc-encode</code> dependency to <code>objc2-encode</code> version
<code>2.0.0-alpha.1</code>, and re-export the new <code>RefEncode</code> trait from that.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Require that the receiver, arguments and return types of
messages always implement <code>Encode</code>. This helps ensuring that only types made
to go across the FFI boundary (<code>repr(C)</code>, …) may. These requirements were
already present when the <code>verify_message</code> feature was enabled.</p>
<p>This is a very <em>disruptive change</em>, since libraries are now required to
implement <code>Encode</code> and <code>RefEncode</code> for all types intended to go across the
FFI-boundary to Objective-C. The change is justified because it helps
ensuring that users only pass valid types to <code>msg_send!</code> (for example, this
prevents users from accidentally passing <code>Drop</code> types to <code>msg_send</code>).</p>
<p>See the following examples for how to implement these traits, and otherwise
refer to the documentation of <code>objc2-encode</code> (<code>v2.0.0-alpha.1</code> or above).</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>objc2::{Encode, Encoding, RefEncode};

<span class="doccomment">/// Example struct.
</span><span class="attr">#[repr(C)]
</span><span class="kw">pub struct </span>NSRange {
    <span class="kw">pub </span>location: usize,
    <span class="kw">pub </span>length: usize,
}
<span class="kw">unsafe impl </span>Encode <span class="kw">for </span>NSRange {
    <span class="kw">const </span>ENCODING: Encoding&lt;<span class="lifetime">'static</span>&gt; = Encoding::Struct(
        <span class="string">"_NSRange"</span>, <span class="comment">// This is how the struct is defined in C header files
        </span><span class="kw-2">&amp;</span>[usize::ENCODING, usize::ENCODING]
    );
}
<span class="kw">unsafe impl </span>RefEncode <span class="kw">for </span>NSRange {
    <span class="kw">const </span>ENCODING_REF: Encoding&lt;<span class="lifetime">'static</span>&gt; = Encoding::Pointer(<span class="kw-2">&amp;</span><span class="self">Self</span>::ENCODING);
}

<span class="doccomment">/// Example object.
</span><span class="attr">#[repr(C)]
</span><span class="kw">pub struct </span>__CFString(c_void);

<span class="kw">pub type </span>CFStringRef = <span class="kw-2">*const </span>__CFString;

<span class="kw">unsafe impl </span>RefEncode <span class="kw">for </span>__CFString {
    <span class="kw">const </span>ENCODING_REF: Encoding&lt;<span class="lifetime">'static</span>&gt; = Encoding::Object;
}</code></pre></div>
</li>
<li>
<p>Temporarily disabled iOS tests.</p>
</li>
</ul>
<h4 id="fixed-10"><a class="doc-anchor" href="#fixed-10">§</a>Fixed</h4>
<ul>
<li>Statically find the correct <code>objc_msgSend[_X]</code> function to use based on the
<code>Encode</code> implementation of the return type. This fixes using functions that
return e.g. <code>type CGFloat = f32 / f64;</code>.</li>
<li>Documentation links.</li>
</ul>
<h3 id="030-alpha0---2021-08-29"><a class="doc-anchor" href="#030-alpha0---2021-08-29">§</a>0.3.0-alpha.0 - 2021-08-29</h3>
<p>Note: This is the version that is, as of this writing, available on the
<code>master</code> branch in the original <code>objc</code> project.</p>
<h4 id="added-17"><a class="doc-anchor" href="#added-17">§</a>Added</h4>
<ul>
<li>Improve macro hygiene.
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// You can now do
</span><span class="kw">use </span>objc2::{sel, class, msg_send};
<span class="comment">// Instead of
</span><span class="attr">#[macro_use]
</span><span class="kw">extern crate </span>objc2;</code></pre></div>
</li>
<li>Update to Rust 2018.</li>
<li>Other internal improvements.</li>
</ul>
<h4 id="changed-16"><a class="doc-anchor" href="#changed-16">§</a>Changed</h4>
<ul>
<li>
<p><strong>BREAKING</strong>: Forked the project, so the crate name is now <code>objc2</code>.</p>
</li>
<li>
<p><strong>BREAKING</strong>: Updated encoding utilities to use <code>objc-encode</code>. See that for
how to use the updated type <code>Encoding</code> and trait <code>Encode</code>.</p>
<p>In short, you will likely need to change your implementations of <code>Encode</code>
like this:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>objc2::{Encode, Encoding};

<span class="kw">pub type </span>CGFloat = ...; <span class="comment">// Varies based on target_pointer_width

</span><span class="attr">#[repr(C)]
</span><span class="kw">pub struct </span>NSPoint {
    <span class="kw">pub </span>x: CGFloat,
    <span class="kw">pub </span>y: CGFloat,
}

<span class="comment">// Before
</span><span class="kw">unsafe impl </span>Encode <span class="kw">for </span>NSPoint {
    <span class="kw">fn </span>encode() -&gt; Encoding {
        <span class="kw">let </span>encoding = <span class="macro">format!</span>(
            <span class="string">"{{CGPoint={}{}}}"</span>,
            CGFloat::encode().as_str(),
            CGFloat::encode().as_str(),
        );
        <span class="kw">unsafe </span>{ Encoding::from_str(<span class="kw-2">&amp;</span>encoding) }
    }
}

<span class="comment">// After
</span><span class="kw">unsafe impl </span>Encode <span class="kw">for </span>NSPoint {
    <span class="kw">const </span>ENCODING: Encoding&lt;<span class="lifetime">'static</span>&gt; = Encoding::Struct(
        <span class="string">"CGPoint"</span>,
        <span class="kw-2">&amp;</span>[CGFloat::ENCODING, CGFloat::ENCODING]
    );
}</code></pre></div>
</li>
<li>
<p><strong>BREAKING</strong>: Updated public dependency <code>malloc_buf</code> to <code>1.0</code>.</p>
</li>
<li>
<p><strong>BREAKING</strong>: <code>Method::return_type</code> and <code>Method::argument_type</code> now return
<code>Malloc&lt;str&gt;</code> instead of <code>Encoding</code>.</p>
</li>
<li>
<p><strong>BREAKING</strong>: <code>Ivar::type_encoding</code> now return <code>&amp;str</code> instead of <code>Encoding</code>.</p>
</li>
</ul>
<h4 id="removed-8"><a class="doc-anchor" href="#removed-8">§</a>Removed</h4>
<ul>
<li><strong>BREAKING</strong>: Removed hidden <code>sel_impl!</code> macro.</li>
</ul>
<h3 id="027-objc-crate---2019-10-19"><a class="doc-anchor" href="#027-objc-crate---2019-10-19">§</a><a href="https://github.com/madsmtm/objc2/compare/objc-0.2.6...objc-0.2.7">0.2.7</a> (<code>objc</code> crate) - 2019-10-19</h3><h4 id="fixed-11"><a class="doc-anchor" href="#fixed-11">§</a>Fixed</h4>
<ul>
<li><strong>BREAKING</strong>: Uses of <code>msg_send!</code> will now correctly fail to compile if no
return type can be inferred, instead of relying on an edge case of the
compiler that will soon change and silently cause undefined behavior.</li>
</ul>
<h3 id="026-objc-crate---2019-03-25"><a class="doc-anchor" href="#026-objc-crate---2019-03-25">§</a><a href="https://github.com/madsmtm/objc2/compare/objc-0.2.5...objc-0.2.6">0.2.6</a> (<code>objc</code> crate) - 2019-03-25</h3><h4 id="fixed-12"><a class="doc-anchor" href="#fixed-12">§</a>Fixed</h4>
<ul>
<li>Suppressed a deprecation warning in <code>sel!</code>, <code>msg_send!</code>, and <code>class!</code>.</li>
</ul>
<h3 id="025-objc-crate---2018-07-24"><a class="doc-anchor" href="#025-objc-crate---2018-07-24">§</a><a href="https://github.com/madsmtm/objc2/compare/objc-0.2.4...objc-0.2.5">0.2.5</a> (<code>objc</code> crate) - 2018-07-24</h3><h4 id="added-18"><a class="doc-anchor" href="#added-18">§</a>Added</h4>
<ul>
<li><strong>BREAKING</strong>: <code>autoreleasepool</code> returns the value returned by its body
closure.</li>
</ul>
<h3 id="024-objc-crate---2018-07-22"><a class="doc-anchor" href="#024-objc-crate---2018-07-22">§</a><a href="https://github.com/madsmtm/objc2/compare/objc-0.2.3...objc-0.2.4">0.2.4</a> (<code>objc</code> crate) - 2018-07-22</h3><h4 id="added-19"><a class="doc-anchor" href="#added-19">§</a>Added</h4>
<ul>
<li>Added an <code>rc</code> module with reference counting utilities:
<code>StrongPtr</code>, <code>WeakPtr</code>, and <code>autoreleasepool</code>.</li>
<li>Added some reference counting ABI foreign functions to the <code>runtime</code> module.</li>
</ul>
<h4 id="fixed-13"><a class="doc-anchor" href="#fixed-13">§</a>Fixed</h4>
<ul>
<li>Messaging nil under GNUstep now correctly returns zeroed results for all
return types.</li>
</ul>
<h3 id="023-objc-crate---2018-07-07"><a class="doc-anchor" href="#023-objc-crate---2018-07-07">§</a><a href="https://github.com/madsmtm/objc2/compare/objc-0.2.2...objc-0.2.3">0.2.3</a> (<code>objc</code> crate) - 2018-07-07</h3><h4 id="added-20"><a class="doc-anchor" href="#added-20">§</a>Added</h4>
<ul>
<li>Added a <code>class!</code> macro for getting statically-known classes. The result is
non-optional (avoiding a need to unwrap) and cached so each usage will only
look up the class once.</li>
<li>Added caching to the <code>sel!</code> macro so that each usage will only register the
selector once.</li>
</ul>
<h4 id="fixed-14"><a class="doc-anchor" href="#fixed-14">§</a>Fixed</h4>
<ul>
<li>Implementation of <code>objc2::runtime</code> structs so there can’t be unsound
references to uninhabited types.</li>
</ul>
<h3 id="022-objc-crate---2016-10-30"><a class="doc-anchor" href="#022-objc-crate---2016-10-30">§</a><a href="https://github.com/madsmtm/objc2/compare/objc-0.2.1...objc-0.2.2">0.2.2</a> (<code>objc</code> crate) - 2016-10-30</h3><h4 id="added-21"><a class="doc-anchor" href="#added-21">§</a>Added</h4>
<ul>
<li>Implemented <code>Sync</code> and <code>Send</code> for <code>Sel</code>.</li>
</ul>
<h3 id="021-objc-crate---2016-04-23"><a class="doc-anchor" href="#021-objc-crate---2016-04-23">§</a><a href="https://github.com/madsmtm/objc2/compare/objc-0.2.0...objc-0.2.1">0.2.1</a> (<code>objc</code> crate) - 2016-04-23</h3><h4 id="added-22"><a class="doc-anchor" href="#added-22">§</a>Added</h4>
<ul>
<li>Added support for working with protocols with the <code>Protocol</code> struct.
The protocols a class conforms to can be examined with the new
<code>Class::adopted_protocols</code> and <code>Class::conforms_to</code> methods.</li>
<li>Protocols can be declared using the new <code>ProtocolDecl</code> struct.</li>
</ul>
<h3 id="020-objc-crate---2016-03-20"><a class="doc-anchor" href="#020-objc-crate---2016-03-20">§</a><a href="https://github.com/madsmtm/objc2/compare/objc-0.1.8...objc-0.2.0">0.2.0</a> (<code>objc</code> crate) - 2016-03-20</h3><h4 id="added-23"><a class="doc-anchor" href="#added-23">§</a>Added</h4>
<ul>
<li>Added verification for the types used when sending messages.
This can be enabled for all messages with the <code>"verify_message"</code> feature,
or you can test before sending specific messages with the
<code>Message::verify_message</code> method. Verification errors are reported using the
new <code>MessageError</code> struct.</li>
<li>Added support for the GNUstep runtime!
Operating systems besides OSX and iOS will fall back to the GNUstep runtime.</li>
<li>Root classes can be declared by using the <code>ClassDecl::root</code> constructor.</li>
</ul>
<h4 id="changed-17"><a class="doc-anchor" href="#changed-17">§</a>Changed</h4>
<ul>
<li><strong>BREAKING</strong>: C types are now used from <code>std::os::raw</code> rather than <code>libc</code>.
This means <code>Encode</code> may not be implemented for <code>libc</code> types; switch them to
the <code>std::os::raw</code> equivalents instead. This avoids an issue that would
arise from simultaneously using different versions of the libc crate.</li>
<li><strong>BREAKING</strong>: Dynamic messaging was moved into the <code>Message</code> trait; instead
of <code>().send(obj, sel!(description))</code>, use
<code>obj.send_message(sel!(description), ())</code>.</li>
<li><strong>BREAKING</strong>: Rearranged the parameters to <code>ClassDecl::new</code> for consistency;
instead of <code>ClassDecl::new(superclass, "MyObject")</code>, use
<code>ClassDecl::new("MyObject", superclass)</code>.</li>
<li><strong>BREAKING</strong>: Overhauled the <code>MethodImplementation</code> trait. Encodings are now
accessed through the <code>MethodImplementation::Args</code> associated type. The
<code>imp_for</code> method was replaced with <code>imp</code> and no longer takes a selector or
returns an <code>UnequalArgsError</code>, although <code>ClassDecl::add_method</code> still
validates the number of arguments.</li>
<li><strong>BREAKING</strong>: Updated the definition of <code>Imp</code> to not use the old dispatch
prototypes. To invoke an <code>Imp</code>, it must first be transmuted to the correct
type.</li>
</ul>
<h4 id="removed-9"><a class="doc-anchor" href="#removed-9">§</a>Removed</h4>
<p><strong>BREAKING</strong>: <code>objc_msgSend</code> functions from the <code>runtime</code> module; the
availability of these functions varies and they shouldn’t be called without
trasmuting, so they are now hidden as an implementation detail of messaging.</p>
<h4 id="fixed-15"><a class="doc-anchor" href="#fixed-15">§</a>Fixed</h4>
<ul>
<li>Corrected alignment of ivars in <code>ClassDecl</code>; declared classes may now have a
smaller size.</li>
<li>With the <code>"exception"</code> or <code>"verify_message"</code> feature enabled, panics from
<code>msg_send!</code> will now be triggered from the line and file where the macro is
used, rather than from within the implementation of messaging.</li>
</ul>
<h3 id="018-objc-crate---2015-11-06"><a class="doc-anchor" href="#018-objc-crate---2015-11-06">§</a><a href="https://github.com/madsmtm/objc2/compare/objc-0.1.7...objc-0.1.8">0.1.8</a> (<code>objc</code> crate) - 2015-11-06</h3><h4 id="changed-18"><a class="doc-anchor" href="#changed-18">§</a>Changed</h4>
<ul>
<li>Updated <code>libc</code> dependency.</li>
</ul>
<h3 id="017-objc-crate---2015-09-23"><a class="doc-anchor" href="#017-objc-crate---2015-09-23">§</a><a href="https://github.com/madsmtm/objc2/compare/objc-0.1.6...objc-0.1.7">0.1.7</a> (<code>objc</code> crate) - 2015-09-23</h3><h4 id="fixed-16"><a class="doc-anchor" href="#fixed-16">§</a>Fixed</h4>
<ul>
<li><code>improper_ctypes</code> warning.</li>
</ul>
<h3 id="016-objc-crate---2015-08-08"><a class="doc-anchor" href="#016-objc-crate---2015-08-08">§</a><a href="https://github.com/madsmtm/objc2/compare/objc-0.1.5...objc-0.1.6">0.1.6</a> (<code>objc</code> crate) - 2015-08-08</h3><h4 id="added-24"><a class="doc-anchor" href="#added-24">§</a>Added</h4>
<ul>
<li>Added <code>"exception"</code> feature which catches Objective-C exceptions and turns
them into Rust panics.</li>
<li>Added support for <code>ARM</code>, <code>ARM64</code> and <code>x86</code> architectures.</li>
<li><strong>BREAKING</strong>: Added <code>Any</code> bound on message return types. In practice this
probably won’t break anything.</li>
<li>Start testing on iOS.</li>
</ul>
<h3 id="015-objc-crate---2015-05-02"><a class="doc-anchor" href="#015-objc-crate---2015-05-02">§</a><a href="https://github.com/madsmtm/objc2/compare/objc-0.1.4...objc-0.1.5">0.1.5</a> (<code>objc</code> crate) - 2015-05-02</h3><h4 id="changed-19"><a class="doc-anchor" href="#changed-19">§</a>Changed</h4>
<ul>
<li><strong>BREAKING</strong>: Renamed <code>IntoMethodImp</code> to <code>MethodImplementation</code>.</li>
<li><strong>BREAKING</strong>: Renamed <code>MethodImplementation::into_imp</code> to <code>::imp_for</code>.</li>
<li><strong>BREAKING</strong>: Relaxed <code>Sized</code> bounds on <code>Encode</code> and <code>Message</code>. In practice
this probably won’t break anything.</li>
</ul>
<h4 id="removed-10"><a class="doc-anchor" href="#removed-10">§</a>Removed</h4>
<ul>
<li><strong>BREAKING</strong>: Removed <code>Id</code>, <code>Owned</code>, <code>Ownership</code>, <code>Shared</code>, <code>ShareId</code> and
<code>WeakId</code>. Use them from the <code>objc_id</code> crate instead.</li>
<li><strong>BREAKING</strong>: Removed <code>Method::set_implementation</code> and
<code>Method::exchange_implementation</code>.</li>
</ul>
<h3 id="014-objc-crate---2015-04-17"><a class="doc-anchor" href="#014-objc-crate---2015-04-17">§</a><a href="https://github.com/madsmtm/objc2/compare/objc-0.1.3...objc-0.1.4">0.1.4</a> (<code>objc</code> crate) - 2015-04-17</h3><h4 id="removed-11"><a class="doc-anchor" href="#removed-11">§</a>Removed</h4>
<ul>
<li><strong>BREAKING</strong>: Removed <code>block</code> module. Use them from the <code>block</code> crate
instead.</li>
</ul>
<h3 id="013-objc-crate---2015-04-11"><a class="doc-anchor" href="#013-objc-crate---2015-04-11">§</a><a href="https://github.com/madsmtm/objc2/compare/objc-0.1.2...objc-0.1.3">0.1.3</a> (<code>objc</code> crate) - 2015-04-11</h3><h4 id="added-25"><a class="doc-anchor" href="#added-25">§</a>Added</h4>
<ul>
<li>Implement <code>fmt::Pointer</code> for <code>Id</code>.</li>
</ul>
<h4 id="fixed-17"><a class="doc-anchor" href="#fixed-17">§</a>Fixed</h4>
<ul>
<li>Odd lifetime bug.</li>
</ul>
<h3 id="012-objc-crate---2015-04-04"><a class="doc-anchor" href="#012-objc-crate---2015-04-04">§</a><a href="https://github.com/madsmtm/objc2/compare/objc-0.1.1...objc-0.1.2">0.1.2</a> (<code>objc</code> crate) - 2015-04-04</h3><h4 id="fixed-18"><a class="doc-anchor" href="#fixed-18">§</a>Fixed</h4>
<ul>
<li><strong>BREAKING</strong>: Replace uses of <code>PhantomFn</code> with <code>Sized</code>.</li>
</ul>
<h3 id="011-objc-crate---2015-03-27"><a class="doc-anchor" href="#011-objc-crate---2015-03-27">§</a><a href="https://github.com/madsmtm/objc2/compare/objc-0.1.0...objc-0.1.1">0.1.1</a> (<code>objc</code> crate) - 2015-03-27</h3><h4 id="added-26"><a class="doc-anchor" href="#added-26">§</a>Added</h4>
<ul>
<li>Implement <code>Error</code> for <code>UnequalArgsError</code>.</li>
</ul>
<h4 id="removed-12"><a class="doc-anchor" href="#removed-12">§</a>Removed</h4>
<ul>
<li><strong>BREAKING</strong>: Move <code>objc::foundation</code> into new crate <code>objc_foundation</code>.</li>
</ul>
</div></details></section></div></main></body></html>